{% extends 'base.html' %}
{% block content %}
<div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-semibold">Bookings</h1>
    <a href="/app/bookings/new" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">New Booking</a>
</div>

<div class="bg-white p-4 rounded-xl shadow-sm border">
    {% if bookings %}
    <ul class="space-y-4">
        {% for b in bookings %}
        <li class="p-4 border rounded-lg flex flex-wrap items-start gap-4">
            {# Room Image #}
            <div class="w-full sm:w-32">
                {% set room = rooms_map.get(b.room_id) %}
                {% if room and room.image_url %}
                    <img src="{{ room.image_url }}" alt="{{ room.name }}" class="w-full h-24 object-cover rounded-md border">
                {% else %}
                    <div class="w-full h-24 bg-gray-100 rounded-md border flex items-center justify-center text-gray-400 text-sm">No Room Image</div>
                {% endif %}
            </div>

            {# Booking Details #}
            <div class="flex-1">
                <div class="flex items-center justify-between">
                    <div class="font-semibold text-lg">{{ b.guest_name }}</div>
                    {% set st = b.status.value %}
                    <span class="px-2 py-1 rounded text-xs font-medium 
                      {% if st == 'confirmed' %} bg-green-100 text-green-800
                      {% elif st == 'checked_in' %} bg-blue-100 text-blue-800
                      {% elif st == 'checked_out' %} bg-gray-100 text-gray-800
                      {% elif st == 'cancelled' %} bg-red-100 text-red-800
                      {% else %} bg-yellow-100 text-yellow-800 {% endif %}">{{ st.replace('_',' ') }}</span>
                </div>
                <div class="text-sm text-gray-600">
                    <strong>Room:</strong> {{ room.name if room else 'Room #' ~ b.room_id }}
                </div>
                <div class="text-sm text-gray-600">
                    <strong>Dates:</strong> {{ b.start_date.isoformat() }} â†’ {{ b.end_date.isoformat() }}
                </div>
                <div class="text-sm text-gray-600">
                    <strong>Price:</strong> {% if b.price is not none %}{{ user.currency|currency_symbol }}{{ '%.2f'|format(b.price|float) }}{% else %}-{% endif %}
                </div>
                {% if b.comment %}
                <div class="text-xs text-gray-500 mt-1">
                    <strong>Comment:</strong> {{ b.comment }}
                </div>
                {% endif %}
            </div>

            {# Actions #}
            <div class="flex flex-col sm:flex-row items-center gap-2 whitespace-nowrap">
                <a href="/app/bookings/{{ b.id }}/edit" class="px-3 py-1.5 text-sm w-full text-center border rounded bg-white hover:bg-gray-50">Edit</a>
                <form method="post" action="/app/bookings/{{ b.id }}/delete" class="w-full" onsubmit="return confirm('Delete this booking?');">
                    <button class="px-3 py-1.5 text-sm w-full text-center border rounded bg-red-50 text-red-700 hover:bg-red-100">Delete</button>
                </form>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
        <p class="text-sm text-gray-600 text-center py-8">No bookings yet.</p>
    {% endif %}
</div>
{% endblock %}
