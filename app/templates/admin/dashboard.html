{% extends 'base.html' %}
{% block content %}
<div class="mb-4 flex items-center justify-between">
  <h1 class="text-2xl font-semibold">Admin Dashboard</h1>
  <div class="flex gap-2">
    <a href="/admin/users" class="px-3 py-2 border rounded bg-white hover:bg-gray-50">Manage Users</a>
    <a href="/admin/plans" class="px-3 py-2 border rounded bg-white hover:bg-gray-50">Assign Subscriptions</a>
    <a href="/admin/plans/manage" class="px-3 py-2 border rounded bg-white hover:bg-gray-50">Manage Plans</a>
    <a href="/admin/settings" class="px-3 py-2 border rounded bg-white hover:bg-gray-50">Admin Settings</a>
  </div>
</div>

{% if analytics %}
<div class="grid md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
    <div class="bg-white p-4 rounded-xl border shadow-sm">
        <h3 class="text-sm font-medium text-gray-500">Total Users</h3>
        <p class="text-3xl font-semibold text-gray-800">{{ analytics.users_count }}</p>
    </div>
    <div class="bg-white p-4 rounded-xl border shadow-sm">
        <h3 class="text-sm font-medium text-gray-500">Total Properties</h3>
        <p class="text-3xl font-semibold text-gray-800">{{ analytics.homestays_count }}</p>
    </div>
    <div class="bg-white p-4 rounded-xl border shadow-sm">
        <h3 class="text-sm font-medium text-gray-500">Total Rooms</h3>
        <p class="text-3xl font-semibold text-gray-800">{{ analytics.rooms_count }}</p>
    </div>
    <div class="bg-white p-4 rounded-xl border shadow-sm">
        <h3 class="text-sm font-medium text-gray-500">Total Bookings</h3>
        <p class="text-3xl font-semibold text-gray-800">{{ analytics.bookings_count }}</p>
    </div>
</div>

<div class="grid lg:grid-cols-3 gap-6 mb-6">
  <div class="bg-white p-4 rounded-xl shadow-sm border">
    <h2 class="font-medium mb-1">This Month (All Users)</h2>
    <div class="text-sm text-gray-500 mb-3">From {{ analytics.month_start.strftime('%B %d, %Y') }}</div>
    <div class="grid grid-cols-2 gap-4">
      <div class="p-3 rounded border bg-gray-50">
        <div class="text-xs text-gray-600">Bookings</div>
        <div class="text-lg font-semibold">{{ analytics.monthly_bookings }}</div>
      </div>
      <div class="p-3 rounded border bg-gray-50">
        <div class="text-xs text-gray-600">Revenue</div>
        <div class="text-lg font-semibold">{{ user.currency|currency_symbol }}{{ '%.2f'|format(analytics.monthly_revenue) }}</div>
      </div>
    </div>
  </div>

  <div class="bg-white p-4 rounded-xl shadow-sm border">
      <h2 class="font-medium mb-2">Key Metrics (This Month)</h2>
      <ul class="text-sm space-y-2">
          <li class="flex justify-between items-center"><span>Occupancy Rate</span><span class="font-semibold">{{ '%.2f'|format(analytics.occupancy_rate) }}%</span></li>
          <li class="flex justify-between items-center"><span>Avg. Daily Rate (ADR)</span><span class="font-semibold">{{ user.currency|currency_symbol }}{{ '%.2f'|format(analytics.adr) }}</span></li>
          <li class="flex justify-between items-center"><span>Revenue Per Room (RevPAR)</span><span class="font-semibold">{{ user.currency|currency_symbol }}{{ '%.2f'|format(analytics.revpar) }}</span></li>
      </ul>
  </div>

  <div class="bg-white p-4 rounded-xl shadow-sm border">
    <h2 class="font-medium mb-2">Plan Distribution</h2>
    <ul class="text-sm divide-y">
      {% for key, val in analytics.plan_counts.items() %}
      <li class="py-1 flex items-center justify-between">
        <div class="uppercase">{{ key }}</div>
        <div class="font-medium">{{ val }}</div>
      </li>
      {% endfor %}
    </ul>
  </div>
</div>

<div class="bg-white p-4 rounded-xl shadow-sm border mb-6">
    <h2 class="font-medium mb-2">User Analytics</h2>
    <div class="overflow-x-auto">
        <table class="w-full text-sm">
            <thead>
                <tr class="text-left border-b bg-gray-50">
                    <th class="py-2 px-2">User</th>
                    <th class="py-2 px-2">Properties</th>
                    <th class="py-2 px-2">Rooms</th>
                    <th class="py-2 px-2">Total Revenue</th>
                </tr>
            </thead>
            <tbody class="divide-y">
                {% for item in analytics.user_analytics %}
                <tr>
                    <td class="py-2 px-2">
                        <div class="font-medium">{{ item.user.email }}</div>
                        <div class="text-xs text-gray-500">id: {{ item.user.id }}</div>
                    </td>
                    <td class="py-2 px-2">{{ item.homestay_count }}</td>
                    <td class="py-2 px-2">{{ item.room_count }}</td>
                    <td class="py-2 px-2">{{ item.user.currency|currency_symbol }}{{ '%.2f'|format(item.total_revenue) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}
{% endblock %}
